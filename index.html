<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>0x3m1r</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="./style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet" />
</head>
<body>

<nav class="navbar navbar-expand-custom navbar-mainbg">
  <a class="navbar-brand navbar-logo" href="#">0x3m1r</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-bars text-white"></i>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav ml-auto">
      <div class="hori-selector"><div class="left"></div><div class="right"></div></div>
      <li class="nav-item active">
        <a class="nav-link" href="#" id="dashboardLink"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/0x3m1r" target="_blank"><i class="fab fa-github"></i> Github</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://www.linkedin.com/in/emir-taylan-g%C3%BCnday-34182a215/" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" id="cvLink"><i class="far fa-file-alt"></i> CV</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" id="ProjectsLink"><i class="far fa-chart-bar"></i> Projects</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" id="ustaAramaLink"><i class="fas fa-map-marker-alt"></i> Usta Arama</a>
      </li>
    </ul>
  </div>
</nav>
<div id="Projects" class="Pt-hidden">
  <div class="row">
    <div class="col-md-12">
      <h1 class="text-center mt-5">Welcome to 0x3m1r's Projects</h1>
      <p class="text-center">Under Construction</p>

      <!-- Nectum Button -->
      <div class="text-center mt-4">
        <button class="btn btn-outline-info" data-toggle="modal" data-target="#nectumModal">
          ğŸš€ Nectum'u KeÅŸfet
        </button>
      </div>
      <!-- Captive Portal Button -->
      <div class="text-center mt-3">
        <button class="btn btn-outline-danger" data-toggle="modal" data-target="#captivePortalModal">
          ğŸ” Captive Portal Projesini GÃ¶r
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Usta Arama Section -->
<div id="UstaArama" class="UA-hidden">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <h1 class="text-center mt-4 mb-4">ğŸ”§ Usta Arama ve Harita</h1>
        <p class="text-center text-muted">Konumunuza yakÄ±n ustalarÄ± bulun ve harita Ã¼zerinde gÃ¶rÃ¼ntÃ¼leyin</p>
      </div>
    </div>
    
    <div class="row">
      <!-- Search Controls -->
      <div class="col-md-4">
        <div class="search-panel p-3">
          <h5><i class="fas fa-search"></i> Arama Filtreleri</h5>
          
          <!-- Location Input -->
          <div class="form-group">
            <label for="locationInput">ğŸ“ Konum</label>
            <input type="text" class="form-control" id="locationInput" placeholder="Åehir veya adres girin..." value="Samsun, TR">
          </div>
          
          <!-- Craft Type Filter -->
          <div class="form-group">
            <label for="craftSelect">ğŸ”§ Usta TÃ¼rÃ¼</label>
            <select class="form-control" id="craftSelect">
              <option value="">TÃ¼mÃ¼</option>
              <option value="elektrikci">ElektrikÃ§i</option>
              <option value="tesisatci">TesisatÃ§Ä±</option>
              <option value="boyaci">BoyacÄ±</option>
              <option value="marangoz">Marangoz</option>
              <option value="tamirci">Tamirci</option>
            </select>
          </div>
          
          <!-- Distance Filter -->
          <div class="form-group">
            <label for="distanceRange">ğŸ“ Maksimum Mesafe: <span id="distanceValue">10</span> km</label>
            <input type="range" class="form-control-range" id="distanceRange" min="1" max="50" value="10">
          </div>
          
          <!-- Rating Filter -->
          <div class="form-group">
            <label for="ratingFilter">â­ Minimum Puan</label>
            <select class="form-control" id="ratingFilter">
              <option value="0">TÃ¼mÃ¼</option>
              <option value="3">3+ YÄ±ldÄ±z</option>
              <option value="4">4+ YÄ±ldÄ±z</option>
              <option value="4.5">4.5+ YÄ±ldÄ±z</option>
            </select>
          </div>
          
          <button class="btn btn-primary btn-block" id="searchBtn">
            <i class="fas fa-search"></i> Ara
          </button>
          
          <button class="btn btn-secondary btn-block mt-2" id="getCurrentLocationBtn">
            <i class="fas fa-crosshairs"></i> Mevcut Konumumu Kullan
          </button>
        </div>
        
        <!-- Results List -->
        <div class="results-panel mt-3 p-3">
          <h5><i class="fas fa-list"></i> SonuÃ§lar (<span id="resultCount">0</span>)</h5>
          <div id="resultsList">
            <!-- Search results will be populated here -->
          </div>
        </div>
      </div>
      
      <!-- Map -->
      <div class="col-md-8">
        <div class="map-container">
          <div id="map" style="height: 600px; border-radius: 10px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>
<div id="Dashboard" class="DS-hidden">
  <div class="row">
    <div class="col-md-12">
      <h1 class="text-center mt-5">Welcome to 0x3m1r's Dashboard</h1>
      <p class="text-center">This is a simple dashboard template with a CV section.</p>
      <iframe src="https://tryhackme.com/api/v2/badges/public-profile?userPublicId=2133455" style='border:none;'></iframe>
      <div class="text-center mt-4">
        <button class="btn btn-outline-success" id="playGameBtn">
          ğŸ® Oyunu Dashboard Ä°Ã§inde AÃ§
        </button>
      </div>
      
      <div id="gameContainer" class="text-center mt-3" style="display: none;">
        <div class="text-center mb-3">
          <button class="btn btn-outline-danger" id="backToDashboardBtn">
            â¬…ï¸ Dashboard'a Geri DÃ¶n
          </button>
        </div>
        <iframe id="gameFrame" src="" width="100%" height="1000px" style="border: none;"></iframe>
      </div>
    </div>
  </div>
</div>
<!-- CV Section -->
<div id="cvContent" class="cv-hidden">
  <div class="layout">
    <div class="sidebar">
      <img src="profile.jpg" alt="Emir's Photo" />
      <h2>Emir Taylan GÃ¼nday</h2>
      <p>Pentester</p>
      <p>Email: emirgundayy@proton.me</p>
      <p>Phone: +90 530 128 78 55</p>
      <p>Location: Samsun, TR</p>
      <p>Age: 24</p>
      <!--<button id="downloadCvBtn">Download CV as PDF</button>   Under Construction-->
    </div>
      <div class="code-block">
        /// &lt;summary&gt;<br/>
        /// CV of Emir Taylan GÃ¼nday as a C# class.<br/>
        /// &lt;/summary&gt;<br/><br/>

        public class INFORMATION {<br/>
        &nbsp;&nbsp;public string NAME = "Emir Taylan GÃ¼nday";<br/>
        &nbsp;&nbsp;public string TITLE = "Pentester";<br/>
        &nbsp;&nbsp;public string EMAIL = "emirgundayy@proton.me";<br/>
        &nbsp;&nbsp;public string LOCATION = "Samsun, TR";<br/>
        &nbsp;&nbsp;public int AGE = 24;<br/>
        }<br/><br/>

        public enum PLATFORMS {<br/>
        &nbsp;&nbsp;Windows,<br/>
        &nbsp;&nbsp;Linux<br/>
        }<br/><br/>

        public enum LANGUAGES {<br/>
        &nbsp;&nbsp;C,<br/>
        &nbsp;&nbsp;Python,<br/>
        &nbsp;&nbsp;Bash,<br/>
        &nbsp;&nbsp;Go<br/>
        }<br/><br/>

        public class EXPERIENCE {<br/>
        &nbsp;&nbsp;public void VBT() {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Role = "Intern";<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Duration = "June 2025 - Present";<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Tools = "-";<br/>
        &nbsp;&nbsp;}<br/>
        }<br/><br/>

        public class EDUCATION {<br/>
        &nbsp;&nbsp;public void University() {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Degree = "Bachelor of Science in Computer Engineering";<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Institution = "Karabuk University";<br/>
        &nbsp;&nbsp;}<br/>
        &nbsp;&nbsp;public void HighSchool() {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Degree = "High School Diploma";<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Institution = "Samsun AltÄ±nkaya Anadolu High School";<br/>
        &nbsp;&nbsp;}<br/>
        &nbsp;&nbsp;public void 42Kocaeli() {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Degree = "42 Kocaeli Code School";<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;var Institution = "42 Kocaeli";<br/>
        &nbsp;&nbsp;}<br/>
        }<br/><br/>

        public class SKILLS {<br/>
        &nbsp;&nbsp;public string[] TechnicalSkills = {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Penetration Testing",<br/>
        &nbsp;&nbsp;};<br/>
        &nbsp;&nbsp;public string[] SoftSkills = {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Problem Solving",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Analytical Thinking",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Team Collaboration",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Effective Communication"<br/>
        &nbsp;&nbsp;};<br/>
        &nbsp;&nbsp;public string[] Tools = {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Burp Suite",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Nmap",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Metasploit",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Wireshark",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Kali Linux"<br/>
        &nbsp;&nbsp;};<br/>
        }<br/><br/>

        public class HOBBIES {<br/>
        &nbsp;&nbsp;public string[] Interests = {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Music",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Programming",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Reading",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Gaming"<br/>
        &nbsp;&nbsp;};<br/>
        }<br/><br/>

        public class LANGUAGES_SPOKEN {<br/>
        &nbsp;&nbsp;public string[] Languages = {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Turkish",<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"English"<br/>
        &nbsp;&nbsp;};<br/>
        }<br/><br/>

        public class CERTIFICATIONS {<br/>
        &nbsp;&nbsp;public string[] Certifications = {<br/>
        &nbsp;&nbsp;}<br/>
        }<br/><br/>

        public class REFERENCES {<br/>
        &nbsp;&nbsp;public string[] References = {<br/>
        &nbsp;&nbsp;&nbsp;&nbsp;"Available upon request"<br/>
        &nbsp;&nbsp;};<br/>
        }<br/><br/>

        public class Projects {<br/>
        &nbsp;&nbsp;public string[] ProjectList = {<br/>
        &nbsp;&nbsp;};<br/>
        }<br/><br/>

        public enum SOCIAL {<br/>
        &nbsp;&nbsp;GitHub,<br/>
        &nbsp;&nbsp;LinkedIn<br/>
        }<br/>
      </div>
  </div>
</div>
<div class="modal fade" id="nectumModal" tabindex="-1" role="dialog" aria-labelledby="nectumModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title" id="nectumModalLabel">ğŸ§  Nectum â€“ Sniffer</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Kapat">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p><strong>Nectum</strong>, Feels Diffrent. <br><br>
        Powered by <strong>asyncio</strong> ve <strong>Python</strong> </p>

        <ul>
          <li>âš¡ Asenkron & HÄ±zlÄ± Port TaramasÄ±</li>
          <li>ğŸ“ IP Lokasyonu, VPN/TOR Tespiti</li>
          <li>ğŸ§  Banner & Port Patternâ€™lerinden OS Tahmini</li>
          <li>ğŸ” SSL Sertifika Bilgisi Analizi</li>
        </ul>

        <p>
          Proje, <strong>0x3m1r</strong> tarafÄ±ndan geliÅŸtirilmektedir. Hem eÄŸitim hem de gerÃ§ek dÃ¼nya sÄ±zma testleri iÃ§in uygundur.
        </p>

        <p class="text-muted"><small>âœ¨ YakÄ±nda: Plugin sistemi, Web ArayÃ¼zÃ¼ ve ML ile OS sÄ±nÄ±flandÄ±rma</small></p>
      </div>
      <div class="modal-footer">
        <a href="https://github.com/0x3m1r/nectum" target="_blank" class="btn btn-dark">
          <i class="fab fa-github"></i> Not Yet Published
        </a>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>
<!-- Captive Portal Modal -->
<div class="modal fade" id="captivePortalModal" tabindex="-1" role="dialog" aria-labelledby="captivePortalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="captivePortalLabel">ğŸ” Captive Portal Projesi</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Kapat">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p><strong>Captive Portal</strong> projesi, Kali Linux ortamÄ±nda Ã§alÄ±ÅŸan, <code>iptables</code> ve <code>ebtables</code> destekli bir gÃ¼venlik sistemidir.</p>
        <ul>
          <li>âœ… Åifreli eriÅŸim (bcrypt hash)</li>
          <li>ğŸ§  MAC spoofing tespiti</li>
          <li>ğŸš« Client isolation & flood korumasÄ±</li>
          <li>ğŸ“‹ Loglama (IP ve MAC kaydÄ±)</li>
          <li>ğŸ§ª Flask tabanlÄ± Web ArayÃ¼zÃ¼</li>
        </ul>
        <p>GÃ¼venliÄŸe Ã¶nem veren aÄŸlar iÃ§in ideal bir giriÅŸ kapÄ±sÄ± saÄŸlar.</p>
      </div>
      <div class="modal-footer">
        <a href="https://github.com/0x3m1r/captativePortal#" target="_blank" class="btn btn-dark">
          <i class="fab fa-github"></i> GitHub'da GÃ¶rÃ¼ntÃ¼le
        </a>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Kapat</button>
      </div>
    </div>
  </div>
</div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

<script>
  // CV gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ toggle et
document.getElementById('dashboardLink').addEventListener('click', function (e) {
  e.preventDefault();
  const dashboard = document.getElementById('Dashboard');
  const cv = document.getElementById('cvContent');

  dashboard.classList.toggle('visible');
  dashboard.classList.toggle('DS-hidden');

  // DiÄŸer bÃ¶lÃ¼mÃ¼ kapat
  cv.classList.add('cv-hidden');
  cv.classList.remove('visible');
  // Projects bÃ¶lÃ¼mÃ¼nÃ¼ kapat
  const projects = document.getElementById('Projects');
  projects.classList.add('Pt-hidden');
  projects.classList.remove('visible');
  // UstaArama bÃ¶lÃ¼mÃ¼nÃ¼ kapat
  const ustaArama = document.getElementById('UstaArama');
  ustaArama.classList.add('UA-hidden');
  ustaArama.classList.remove('visible');
});
// Projects gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ toggle et
document.getElementById('ProjectsLink').addEventListener('click', function (e) {
  e.preventDefault();
  const projects = document.getElementById('Projects');
  const dashboard = document.getElementById('Dashboard');
  const cv = document.getElementById('cvContent');
  projects.classList.toggle('visible');
  projects.classList.toggle('Pt-hidden');
  // DiÄŸer bÃ¶lÃ¼mleri kapat
  dashboard.classList.add('DS-hidden');
  dashboard.classList.remove('visible');
  cv.classList.add('cv-hidden');
  cv.classList.remove('visible');
  // UstaArama bÃ¶lÃ¼mÃ¼nÃ¼ kapat
  const ustaArama = document.getElementById('UstaArama');
  ustaArama.classList.add('UA-hidden');
  ustaArama.classList.remove('visible');
});

// CV toggle
document.getElementById('cvLink').addEventListener('click', function (e) {
  e.preventDefault();
  const cv = document.getElementById('cvContent');
  const dashboard = document.getElementById('Dashboard');

  cv.classList.toggle('visible');
  cv.classList.toggle('cv-hidden');

  // DiÄŸer bÃ¶lÃ¼mÃ¼ kapat
  dashboard.classList.add('DS-hidden');
  dashboard.classList.remove('visible');
  // Projects bÃ¶lÃ¼mÃ¼nÃ¼ kapat
  const projects = document.getElementById('Projects');
  projects.classList.add('Pt-hidden');
  projects.classList.remove('visible');
  // UstaArama bÃ¶lÃ¼mÃ¼nÃ¼ kapat
  const ustaArama = document.getElementById('UstaArama');
  ustaArama.classList.add('UA-hidden');
  ustaArama.classList.remove('visible');
});
// Usta Arama gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ toggle et
document.getElementById('ustaAramaLink').addEventListener('click', function (e) {
  e.preventDefault();
  const ustaArama = document.getElementById('UstaArama');
  const dashboard = document.getElementById('Dashboard');
  const cv = document.getElementById('cvContent');
  const projects = document.getElementById('Projects');
  
  ustaArama.classList.toggle('visible');
  ustaArama.classList.toggle('UA-hidden');
  
  // DiÄŸer bÃ¶lÃ¼mleri kapat
  dashboard.classList.add('DS-hidden');
  dashboard.classList.remove('visible');
  cv.classList.add('cv-hidden');
  cv.classList.remove('visible');
  projects.classList.add('Pt-hidden');
  projects.classList.remove('visible');
  
  // HaritayÄ± baÅŸlat (eÄŸer daha Ã¶nce baÅŸlatÄ±lmamÄ±ÅŸsa)
  if (ustaArama.classList.contains('visible')) {
    setTimeout(initializeMap, 100);
  }
});

  // PDF indir
  document.getElementById('downloadCvBtn').addEventListener('click', function () {
    const cvContent = document.getElementById('cvContent');
    const downloadBtn = document.getElementById('downloadCvBtn');
    downloadBtn.style.display = 'none';

    const options = {
      margin: [0.5, 0.5, 0.5, 0.5],
      filename: 'Emir_Taylan_Gunday_CV.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2, useCORS: true },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
      pagebreak: {
        mode: ['avoid-all', 'css', 'legacy'],
        before: ['#page-break-before'],
        after: ['#page-break-after'],
        avoid: ['.no-break']
      }
    };

    html2pdf().set(options).from(cvContent).save().then(() => {
      downloadBtn.style.display = '';
    });
  });
  
</script>
<script>
  // Oyun butonuna tÄ±klandÄ±ÄŸÄ±nda oyunu dashboard iÃ§inde aÃ§ ve dashboard iÃ§eriÄŸini gizle
  document.getElementById('playGameBtn').addEventListener('click', function () {
    const gameContainer = document.getElementById('gameContainer');
    const gameFrame = document.getElementById('gameFrame');
    
    // Oyun iframe'ini yÃ¼kle ve gÃ¶ster
    gameFrame.src = 'dist/index.html';
    gameContainer.style.display = 'block';
    
    // Dashboard iÃ§eriÄŸini gizle (baÅŸlÄ±k, aÃ§Ä±klama ve oyun butonu)
    const dashboardElements = document.querySelectorAll('#Dashboard .row .col-md-12 > *:not(#gameContainer)');
    dashboardElements.forEach(element => {
      if (element !== gameContainer) {
        element.style.display = 'none';
      }
    });
  });
  
  // Dashboard'a geri dÃ¶nÃ¼ÅŸ butonu
  document.getElementById('backToDashboardBtn').addEventListener('click', function () {
    const gameContainer = document.getElementById('gameContainer');
    const gameFrame = document.getElementById('gameFrame');
    
    // Oyunu gizle
    gameContainer.style.display = 'none';
    gameFrame.src = '';
    
    // Dashboard iÃ§eriÄŸini gÃ¶ster
    const dashboardElements = document.querySelectorAll('#Dashboard .row .col-md-12 > *:not(#gameContainer)');
    dashboardElements.forEach(element => {
      element.style.display = '';
    });
  });
</script>

<!-- Usta Arama Map and Search Functionality -->
<script>
let map;
let markersCluster;
let userLocation = null;

// Sample craftsman data with coordinates
const craftsmenData = [
  {
    id: 1,
    name: "Ahmet YÄ±lmaz",
    type: "elektrikci",
    lat: 41.2867,
    lng: 36.3300,
    address: "Atakent Mah., Samsun",
    phone: "+90 555 123 4567",
    rating: 4.8,
    reviews: 45,
    experience: "8 yÄ±l"
  },
  {
    id: 2,
    name: "Mehmet Kaya",
    type: "tesisatci",
    lat: 41.2950,
    lng: 36.3420,
    address: "Ä°lkadÄ±m, Samsun",
    phone: "+90 555 234 5678",
    rating: 4.5,
    reviews: 32,
    experience: "12 yÄ±l"
  },
  {
    id: 3,
    name: "Fatma Demir",
    type: "boyaci",
    lat: 41.2800,
    lng: 36.3200,
    address: "Canik, Samsun",
    phone: "+90 555 345 6789",
    rating: 4.9,
    reviews: 67,
    experience: "6 yÄ±l"
  },
  {
    id: 4,
    name: "Ali Ã–ztÃ¼rk",
    type: "marangoz",
    lat: 41.3000,
    lng: 36.3500,
    address: "TekkekÃ¶y, Samsun",
    phone: "+90 555 456 7890",
    rating: 4.6,
    reviews: 28,
    experience: "15 yÄ±l"
  },
  {
    id: 5,
    name: "AyÅŸe Ã‡elik",
    type: "elektrikci",
    lat: 41.2700,
    lng: 36.3100,
    address: "Bafra, Samsun",
    phone: "+90 555 567 8901",
    rating: 4.3,
    reviews: 21,
    experience: "5 yÄ±l"
  },
  {
    id: 6,
    name: "Hasan KoÃ§",
    type: "tamirci",
    lat: 41.2950,
    lng: 36.3300,
    address: "Merkez, Samsun",
    phone: "+90 555 678 9012",
    rating: 4.7,
    reviews: 39,
    experience: "10 yÄ±l"
  }
];

// Initialize map
function initializeMap() {
  if (map) return; // Map already initialized
  
  try {
    // Check if Leaflet is available
    if (typeof L !== 'undefined') {
      // Initialize map centered on Samsun, Turkey
      map = L.map('map').setView([41.2867, 36.3300], 11);
      
      // Add tile layer (OpenStreetMap)
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
      }).addTo(map);
      
      // Initialize marker cluster group
      markersCluster = L.markerClusterGroup();
      
      // Add markers for all craftsmen
      addCraftsmenMarkers();
    } else {
      // Fallback: Show message that map is not available
      document.getElementById('map').innerHTML = `
        <div style="height: 100%; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 10px;">
          <div style="text-align: center; color: #6c757d;">
            <i class="fas fa-map-marked-alt" style="font-size: 3rem; margin-bottom: 1rem;"></i>
            <h5>Harita YÃ¼klenemedi</h5>
            <p>Harici kaynaklar engellendiÄŸi iÃ§in harita gÃ¶sterilemiyor.<br>
            Arama sonuÃ§larÄ± listede gÃ¶rÃ¼ntÃ¼lenmektedir.</p>
          </div>
        </div>
      `;
    }
  } catch (error) {
    console.error('Map initialization error:', error);
    // Show fallback message
    document.getElementById('map').innerHTML = `
      <div style="height: 100%; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 10px;">
        <div style="text-align: center; color: #6c757d;">
          <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 1rem;"></i>
          <h5>Harita HatasÄ±</h5>
          <p>Harita yÃ¼klenirken bir hata oluÅŸtu.<br>
          Arama sonuÃ§larÄ± listede gÃ¶rÃ¼ntÃ¼lenmektedir.</p>
        </div>
      </div>
    `;
  }
  
  // Setup search functionality regardless of map availability
  setupSearchControls();
  
  // Try to get user location
  getUserLocation();
}

// Add craftsmen markers to map
function addCraftsmenMarkers() {
  if (!markersCluster || typeof L === 'undefined') return;
  
  markersCluster.clearLayers();
  
  craftsmenData.forEach(craftsman => {
    const marker = L.marker([craftsman.lat, craftsman.lng]);
    
    const popupContent = `
      <div style="min-width: 200px;">
        <h6><strong>${craftsman.name}</strong></h6>
        <p><i class="fas fa-tools"></i> ${getCraftTypeName(craftsman.type)}</p>
        <p><i class="fas fa-map-marker-alt"></i> ${craftsman.address}</p>
        <p><i class="fas fa-phone"></i> ${craftsman.phone}</p>
        <p><i class="fas fa-star" style="color: #ffc107;"></i> ${craftsman.rating} (${craftsman.reviews} deÄŸerlendirme)</p>
        <p><i class="fas fa-briefcase"></i> ${craftsman.experience} deneyim</p>
        <button class="btn btn-sm btn-primary" onclick="selectCraftsman(${craftsman.id})">
          Ä°letiÅŸime GeÃ§
        </button>
      </div>
    `;
    
    marker.bindPopup(popupContent);
    markersCluster.addLayer(marker);
  });
  
  if (map) {
    map.addLayer(markersCluster);
  }
}

// Setup search controls
function setupSearchControls() {
  // Distance range slider update
  document.getElementById('distanceRange').addEventListener('input', function(e) {
    document.getElementById('distanceValue').textContent = e.target.value;
  });
  
  // Search button
  document.getElementById('searchBtn').addEventListener('click', performSearch);
  
  // Current location button
  document.getElementById('getCurrentLocationBtn').addEventListener('click', getUserLocation);
  
  // Auto-search on filter changes
  document.getElementById('craftSelect').addEventListener('change', performSearch);
  document.getElementById('ratingFilter').addEventListener('change', performSearch);
  document.getElementById('distanceRange').addEventListener('change', performSearch);
}

// Perform search with filters
function performSearch() {
  const location = document.getElementById('locationInput').value;
  const craftType = document.getElementById('craftSelect').value;
  const maxDistance = parseFloat(document.getElementById('distanceRange').value);
  const minRating = parseFloat(document.getElementById('ratingFilter').value);
  
  // If location is specified, geocode it first
  if (location && location !== 'Samsun, TR') {
    geocodeLocation(location).then(coords => {
      if (coords) {
        userLocation = coords;
        map.setView([coords.lat, coords.lng], 12);
        filterAndDisplayResults(craftType, maxDistance, minRating);
      }
    });
  } else {
    // Use default Samsun location or user's current location
    if (!userLocation) {
      userLocation = { lat: 41.2867, lng: 36.3300 }; // Samsun center
    }
    filterAndDisplayResults(craftType, maxDistance, minRating);
  }
}

// Simple geocoding function (using Nominatim)
async function geocodeLocation(address) {
  try {
    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`);
    const data = await response.json();
    
    if (data && data.length > 0) {
      return {
        lat: parseFloat(data[0].lat),
        lng: parseFloat(data[0].lon)
      };
    }
  } catch (error) {
    console.error('Geocoding error:', error);
  }
  return null;
}

// Filter and display results
function filterAndDisplayResults(craftType, maxDistance, minRating) {
  if (!userLocation) return;
  
  let filteredCraftsmen = craftsmenData.filter(craftsman => {
    // Filter by craft type
    if (craftType && craftsman.type !== craftType) return false;
    
    // Filter by rating
    if (craftsman.rating < minRating) return false;
    
    // Calculate distance
    const distance = calculateDistance(
      userLocation.lat, userLocation.lng,
      craftsman.lat, craftsman.lng
    );
    
    // Filter by distance
    if (distance > maxDistance) return false;
    
    craftsman.distance = distance;
    return true;
  });
  
  // Sort by distance
  filteredCraftsmen.sort((a, b) => a.distance - b.distance);
  
  // Update results list
  displayResults(filteredCraftsmen);
  
  // Update map markers
  updateMapMarkers(filteredCraftsmen);
}

// Calculate distance between two points (Haversine formula)
function calculateDistance(lat1, lng1, lat2, lng2) {
  const R = 6371; // Earth's radius in km
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

// Display search results
function displayResults(craftsmen) {
  const resultsList = document.getElementById('resultsList');
  const resultCount = document.getElementById('resultCount');
  
  resultCount.textContent = craftsmen.length;
  
  if (craftsmen.length === 0) {
    resultsList.innerHTML = '<p class="text-muted text-center">Arama kriterlerinize uygun usta bulunamadÄ±.</p>';
    return;
  }
  
  const resultsHTML = craftsmen.map(craftsman => `
    <div class="result-item" onclick="focusOnMarker(${craftsman.lat}, ${craftsman.lng})">
      <div class="name">${craftsman.name}</div>
      <div class="type">${getCraftTypeName(craftsman.type)}</div>
      <div class="distance">
        ğŸ“ ${craftsman.distance ? craftsman.distance.toFixed(1) + ' km uzaklÄ±kta' : ''}
        <span class="rating">â­ ${craftsman.rating}</span>
      </div>
    </div>
  `).join('');
  
  resultsList.innerHTML = resultsHTML;
}

// Update map markers based on filtered results
function updateMapMarkers(filteredCraftsmen) {
  if (!markersCluster || typeof L === 'undefined' || !map) return;
  
  markersCluster.clearLayers();
  
  // Add user location marker if available
  if (userLocation) {
    const userMarker = L.marker([userLocation.lat, userLocation.lng], {
      icon: L.icon({
        iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
        shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
        iconSize: [25, 41],
        iconAnchor: [12, 41],
        popupAnchor: [1, -34],
        shadowSize: [41, 41]
      })
    }).bindPopup('ğŸ“ Konumunuz');
    
    markersCluster.addLayer(userMarker);
  }
  
  // Add filtered craftsmen markers
  filteredCraftsmen.forEach(craftsman => {
    const marker = L.marker([craftsman.lat, craftsman.lng]);
    
    const popupContent = `
      <div style="min-width: 200px;">
        <h6><strong>${craftsman.name}</strong></h6>
        <p><i class="fas fa-tools"></i> ${getCraftTypeName(craftsman.type)}</p>
        <p><i class="fas fa-map-marker-alt"></i> ${craftsman.address}</p>
        <p><i class="fas fa-phone"></i> ${craftsman.phone}</p>
        <p><i class="fas fa-star" style="color: #ffc107;"></i> ${craftsman.rating} (${craftsman.reviews} deÄŸerlendirme)</p>
        <p><i class="fas fa-briefcase"></i> ${craftsman.experience} deneyim</p>
        ${craftsman.distance ? `<p><i class="fas fa-route"></i> ${craftsman.distance.toFixed(1)} km uzaklÄ±kta</p>` : ''}
        <button class="btn btn-sm btn-primary" onclick="selectCraftsman(${craftsman.id})">
          Ä°letiÅŸime GeÃ§
        </button>
      </div>
    `;
    
    marker.bindPopup(popupContent);
    markersCluster.addLayer(marker);
  });
  
  map.addLayer(markersCluster);
}

// Get user's current location
function getUserLocation() {
  if (navigator.geolocation) {
    document.getElementById('getCurrentLocationBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Konum alÄ±nÄ±yor...';
    
    navigator.geolocation.getCurrentPosition(
      function(position) {
        userLocation = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
        
        map.setView([userLocation.lat, userLocation.lng], 13);
        document.getElementById('locationInput').value = 'Mevcut konumunuz';
        document.getElementById('getCurrentLocationBtn').innerHTML = '<i class="fas fa-crosshairs"></i> Mevcut Konumumu Kullan';
        
        performSearch();
      },
      function(error) {
        console.error('Geolocation error:', error);
        alert('Konum bilgisi alÄ±namadÄ±. LÃ¼tfen manuel olarak konum girin.');
        document.getElementById('getCurrentLocationBtn').innerHTML = '<i class="fas fa-crosshairs"></i> Mevcut Konumumu Kullan';
      }
    );
  } else {
    alert('TarayÄ±cÄ±nÄ±z konum servislerini desteklemiyor.');
  }
}

// Focus on specific marker
function focusOnMarker(lat, lng) {
  if (!map || !markersCluster || typeof L === 'undefined') {
    // If map is not available, just highlight the result item
    return;
  }
  
  map.setView([lat, lng], 15);
  
  // Find and open the marker popup
  markersCluster.eachLayer(function(layer) {
    if (layer.getLatLng().lat === lat && layer.getLatLng().lng === lng) {
      layer.openPopup();
    }
  });
}

// Select craftsman (contact action)
function selectCraftsman(id) {
  const craftsman = craftsmenData.find(c => c.id === id);
  if (craftsman) {
    alert(`${craftsman.name} ile iletiÅŸime geÃ§iliyor...\nTelefon: ${craftsman.phone}`);
    // Here you could implement actual contact functionality
  }
}

// Get craft type display name
function getCraftTypeName(type) {
  const types = {
    'elektrikci': 'âš¡ ElektrikÃ§i',
    'tesisatci': 'ğŸ”§ TesisatÃ§Ä±',
    'boyaci': 'ğŸ¨ BoyacÄ±',
    'marangoz': 'ğŸªµ Marangoz',
    'tamirci': 'ğŸ”¨ Tamirci'
  };
  return types[type] || type;
}

// Initial search when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Perform initial search after a short delay
  setTimeout(() => {
    if (document.getElementById('UstaArama').classList.contains('visible')) {
      performSearch();
    }
  }, 500);
});
</script>

<script src="./script.js"></script>
</body>
</html>
